version: '3'
services:

  ##### NGINX #####
  rl-frontend:

    restart: always

    container_name: rl-frontend
    hostname: rl-frontend

    build:
      context: ./frontend-context/

    depends_on:
        - rl-backend

    ports:
      - 80:80

    networks:
      rl-network:
        ipv4_address: 192.168.200.2

    entrypoint: ["/init-frontend.sh"]

    command: ["nginx", "-g", "daemon off;"]

  ##### Flask #####
  rl-backend:

    restart: always

    container_name: rl-backend
    hostname: rl-backend

    depends_on:
        - rl-database

    build:
      context: ./backend-context/
      args:
        - flask_port=5000

    ports:
        - 5000:5000

    environment:
        - FLASK_APP=run.py
        - FLASK_PORT=5000
        - DB_USER=rl-user
        - IN_CONTAINER=True
        - DB_PASSWORD=rl-specialpassword
        - DB_SERVER=rl-database
        - DB_NAME=rl-database
        - LC_ALL=C.UTF-8
        - LANG=C.UTF-8

    networks:
      rl-network:
        ipv4_address: 192.168.200.3

    #volumes:
    #   - /var/rl-app/rl-images:/home/rl-user/rl-app/rl-images/

  ##### MySQL #####
  rl-database:

    image: mysql

    privileged: true
    restart: always

    container_name: rl-database
    hostname: rl-database

    networks:
      rl-network:
        ipv4_address: 192.168.200.4

    environment:
        - MYSQL_DATABASE=rl-database
        - MYSQL_USER=rl-user
        - MYSQL_PASSWORD=rl-specialpassword
        - MYSQL_ROOT_PASSWORD=root
        - TZ=Europe/Bucharest

    ports:
        - 3306:3306

    #volumes:
    #   - /var/rl-app/db-volume:/var/lib/mysql


### Networks ###
networks:
  rl-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 192.168.200.0/24
